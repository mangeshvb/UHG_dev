<apex:page controller="ACETProviderLookUpDetailController" > <!-- action="{!CallGetProviderWS}" -->
    <style>
        .headerResultStyle {
        font-size: 15px;
        font-weight: Bold;
        }    
        
        .apexp .bPageBlock.apexDefaultPageBlock .pbBody .pbSubheader {
        border-top: 2px solid #cfeef8 !important;
        color: #000;
        }
        
        .homeTab .tertiaryPalette, .individualPalette .homeBlock .tertiaryPalette,
        .layoutEdit .individualPalette .homeBlock 
        
        .tertiaryPalette {
        background-color: white;
        eady border-color: #cfeef8;
        }
        
        body .bPageBlock, body #bodyCell .bResource .secondaryPalette, body .secondaryPalette.bPageBlock,
        body .individualPalette 
        
        .secondaryPalette.bPageBlock, body .bodyDiv .genericTable, body .genericPageBlockTable,
        body .bodyDiv .bSubBlock, body .bComponentBlock 
        
        .bPageBlock, body .bMyDashboard .bPageBlock, body.rlHoverFrame .bPageBlock,
        body.subjectSelectionPopup div.choicesBox, body.lookupTab 
        
        .secondaryPalette.bPageBlock, body.popupTab .secondaryPalette.bPageBlock,
        body.UserTagStatsPage .secondaryPalette.bPageBlock {
        background-color: #fff;
        border-bottom: none;
        border-left: none;
        border-right: none;
        -moz-border-radius: 0px;
        -webkit-border-radius: 0px;
        border-radius: 0px;
        }
        
        .homeTab .secondaryPalette, .individualPalette .homeBlock .secondaryPalette
        {
        background-color: #fff;
        border-color: #cfeef8;
        }
        
        .homeTab .listViewport .subNav .linkBar, .homeTab .mComponent .cHeader,
        .homeTab .genericTable, .homeTab .bSubBlock, .homeTab 
        
        .bPageBlock {
        border-top: none;
        }
        
        .pbSubheader {
        background-color: #fff;
        font-weight: bold;
        font-size: 91%;
        padding: 2px 2px 2px 5px;
        margin-top: 15px;
        overflow: hidden;
        margin-bottom: 2px;
        }
        
        .bPageBlock .detailList .labelCol {
        width: 20%;
        }
        
        input {
        padding-top: 0;
        vertical-align: middle;
        }
        
        .bPageBlock .detailList .dataCol {
        width: 19%;
        }
        
        .apexp .bPageBlock.apexDefaultPageBlock .pbBody .pbSubheader .showListButton{
        background-position: 1px -1px;
        }
        
        .apexp .bPageBlock.apexDefaultPageBlock .pbBody .pbSubheader .hideListButton{
        background-position: 1px -11px;
        }
        
        .apexp .bPageBlock.apexDefaultPageBlock .pbBody .pbSubheader{
        border-top: 0;
        color: #000;
        }
        
        .bPageBlock .dataCol {
        padding-top: 2px;
        padding-right: 115px;
        padding-bottom: 2px;
        padding-left: 10px;
        text-align: left;
        }
    </style>
    <apex:form >
        <apex:includeScript value="{!$Resource.JQuery}"></apex:includeScript>
        <apex:includeScript value="/support/console/30.0/integration.js" />
        <apex:includeScript value="{!$Resource.JqueryTableSorter}"></apex:includeScript>
        <apex:stylesheet value="{!URLFOR($Resource.ACETResources, '/css/m/memberdetail.css')}" />
        <apex:stylesheet value="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
        <apex:includeScript value="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></apex:includeScript>
        <apex:includeScript value="/soap/ajax/30.0/connection.js" />
        <script type="text/javascript">
        var RefreshAA = false;
        var RefreshAffiliations = false;
        function ToggleAdditionalAddress(pbSection) {
            if (!RefreshAA) {
                RefreshAA = true;
                GetAdditionalAddresses();
            }
        }
        
        function ToggleAffiliations(pbSection) {
            if (!RefreshAffiliations) {               
                RefreshAffiliations = true;
                GetAffiliations();
            }
        } 
                
        function initCoverageTable(){
            $("[id$='coverage-table']").tablesorter({
                sortList: [[1,0],[7,1],[6,1]]
            }); 
        }
        function FetchContracts(ProviderId){
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.ACETProviderLookUpDetailController.fetchProviderContracts}',ProviderId,
                function(result, event)
                {
                    if (event.status) 
                    {
                        coverageList();     
                    }
                    else if (event.type === 'exception') 
                    {
                        alert(event.message + ', ' + event.where);
                    } 
                        else 
                        {
                            alert(event.message);
                        }
                }, 
                {escape: true}
            );
            return false;
        }
        
        function onContractSectionControl(){
            
            var contracts = {!lstACETProvider.size}; 
            if(contracts != 0){
                $("[id$='coverage-table']").tablesorter({
                    sortList: [[3,1]]
                }); 
            }       
        }
        function onclickCheck(){ 
            
            coverageList();
        }
        
        $(document).ready(function() {
            
            acet.autodoc.startAutodoc();
            acet.autodoc.createCommentsbox();            
            
            var subjectId = '{!conObj.Id}';
            sforce.console.addEventListener('RequestProviderDetail_'.concat(subjectId), function(r){ 
                sforce.console.getEnclosingTabId(function(result){                                        
                    var res = {};   
                    res.subTabId = result.id;           
                    res.doc = acet.autodoc.saveAutodoc();                                                  
                    sforce.console.fireEvent('ReceiveProviderDetail_'.concat(subjectId), JSON.stringify(res)); 
                }); 
                
            });
            
            //sync comments between claim search and claim details tabs
            //only fire at last keyup
            var timer;
            $("#autodocComments").keyup(function(){
                clearTimeout(timer);  
                timer = setTimeout(function(){
                    sforce.console.fireEvent('ProviderCommentsUpdated_'.concat(subjectId), $("#autodocComments").val()); 
                }, 500);   
            });   
            
            sforce.console.addEventListener('ProviderCommentsUpdated_'.concat(subjectId), function(r){
                $("#autodocComments").val(r.message);
            });                      
            
            //sync comment from claim search when detail page is loaded
            sforce.console.fireEvent('RequestProviderComments_'.concat(subjectId), subjectId);
            
            //close self when requested from claim search page
            sforce.console.addEventListener('CloseProviderDetailSubTab_'.concat(subjectId), function(r){
                sforce.console.getEnclosingTabId(function(result){
                    sforce.console.closeTab(result.id);        
                });
                
            });
            
            afOnPageLoad();
            
        });
        
        function ContractNetwork_OnClick(NetworkName, effectivedt, canceldt, ProviderId, taxId, PTINTypeCode, addressId, 
            addrTypeCode, contractDetailId, contractHeaderId, networkId, benefitPlanId, networkScheduleId) {
            var url;
            var hightlightPanelInfo = $("[id$='highlightPanelInfo']").val(); 
            var urlParam = 'interactionId={!JSENCODE(interaction.Id)}' +'&' + 'contactId={!JSENCODE(conObj.Id)}' + '&' + 'sourceOriginator={!sourceOriginator}' + '&' + 'additionalInfo=' + hightlightPanelInfo;
                urlParam += '&PID=' + ProviderId + '&TID=' + taxId + '&PTINTC=' + PTINTypeCode + '&AID=' + addressId + '&ATC=' + addrTypeCode;
                urlParam += '&CNTRDID=' + contractDetailId + '&CNTRHID=' + contractHeaderId + '&NID=' + networkId + '&BPID=' + benefitPlanId + '&NSID=' + networkScheduleId;
            url = '/apex/ACETContractDetails?'+urlParam; 
            sforce.console.getEnclosingPrimaryTabId(function(result) {
                sforce.console.openSubtab(result.id, url, true, NetworkName + ' '+ effectivedt + '-' + canceldt, null);// null, unique_ProvId_TaxId
            });
            return false;
        }
        
        </script>
        <apex:actionFunction name="afOnPageLoad" action="{!CallWSOnPageLoad1}" rerender="pbsGeneralInfo,coverages,pbsPracticeInfo" status="AjaxLoader" oncomplete="acet.autodoc.startAutodoc();"/>
        <apex:actionFunction name="GetAdditionalAddresses" action="{!callFindMedicalProvider}" reRender="pbtAdditionalAddresses,pbtNoAA" status="AjaxLoader" oncomplete="acet.autodoc.startAutodoc();">
        
        </apex:actionFunction>
        <apex:actionFunction name="GetAffiliations" action="{!CallFindAffiliations}" reRender="pbtAffiliations" status="AjaxLoader" oncomplete="acet.autodoc.startAutodoc();"/>
        <c:ACETInteractionHighlightsPanel InteractionAtt="{!interaction}"
                                          SubjectAtt="{!conObj}" AdditionalInfoAtt="{!additionalInfo}"></c:ACETInteractionHighlightsPanel>
        <apex:pageMessages id="pgMsg"></apex:pageMessages>
        <apex:sectionheader subTitle="Provider  Look Up Details" title="" />
        
        <apex:pageBlock mode="maindetail" id="coveragesPageBlock">
            <apex:pageblocksection columns="1" rendered="{!!isProviderLookupDetailsResult}"
                                   title="Provider Lookup Results" collapsible="false"
                                   html-auto-doc="auto" html-auto-doc-case-items="true" id="pbProviderLookupDetails">
                
                <apex:pageblockTable value="{!lstProviderLookup}"
                                     var="objProviderLookupResult"  >
                    
                    <apex:column value="{!objProviderLookupResult.providerId}"
                                 headerValue="Provider ID" />
                    <apex:column value="{!objProviderLookupResult.fullName}"
                                 headerValue="Name" />
                    <apex:column value="{!objProviderLookupResult.providerType}"
                                 headerValue="Provider Type" />
                    <apex:column value="{!objProviderLookupResult.taxId}"
                                 headerValue="Tax ID" />
                    <apex:column value="{!objProviderLookupResult.address}"
                                 headerValue="Address" />
                    <apex:column value="{!objProviderLookupResult.phoneNumber}"
                                 headerValue="Phone Number" />
                    <apex:column value="{!objProviderLookupResult.speciality}"
                                 headerValue="Specialty" />
                    <apex:column value="{!objProviderLookupResult.PCPRole}"
                                 headerValue="PCP Role" />
                    <apex:column value="{!objProviderLookupResult.gender}"
                                 headerValue="Gender" />
                    <apex:column value="{!objProviderLookupResult.uphd}"
                                 headerValue="UHPD" />
                    <apex:column value="{!objProviderLookupResult.acceptNewPatient}"
                                 headerValue="Platinum Provider" />
                    <apex:column value="{!objProviderLookupResult.Radious}"
                                 headerValue="Radius" />
                </apex:pageblockTable>
            </apex:pageblocksection>
            <apex:pageBlockSection title="General Information" columns="3"
                                   collapsible="true" html-auto-doc="true" id="pbsGeneralInfo">
                <apex:pageblocksectionitem >
                    <apex:outputlabel value="" style="white-space: nowrap;">Facility/Group Name
                    </apex:outputlabel>
                    <apex:outputtext value="{!providerDetail.generalInfo.lastName}" style="white-space: nowrap;"/>
                </apex:pageblocksectionItem>
                <apex:pageblocksectionitem >
                    <apex:outputlabel value="">Tax ID 
                    </apex:outputlabel>
                    <apex:outputtext value="{!providerDetail.generalInfo.taxId}" />
                </apex:pageblocksectionItem>
                <apex:pageblocksectionitem >
                    <apex:outputlabel value="">Provider ID                                            
                    </apex:outputlabel>
                    <apex:outputtext value="{!providerDetail.generalInfo.providerID}" />
                </apex:pageblocksectionItem>
                
                <apex:pageblocksectionitem >
                    <apex:outputlabel value="">NPI</apex:outputLabel>
                    <apex:outputPanel rendered="{!leftnpi.size>0}">
                    <apex:selectList value="{!Dummy}" size="1"  >
                             <apex:selectOptions value="{!leftnpi}"/>
                    </apex:selectList>
                    </apex:outputPanel>
                </apex:pageblocksectionItem>
                <apex:pageblocksectionitem >
                    <apex:outputlabel value="" style="white-space: nowrap;">Healthcare Organization TIN Owner</apex:outputlabel>
                    <apex:outputtext value="{!providerDetail.generalInfo.providerTINOwner}" style="white-space: nowrap;"/>
                </apex:pageblocksectionItem>
                <apex:pageblocksectionitem >
                    <apex:outputlabel value="" style="white-space: nowrap;">Healthcare Organization Type Code
                    </apex:outputlabel>
                    <apex:outputtext value="{!providerDetail.generalInfo.hcoTypeCode}"/>
                </apex:pageblocksectionItem>
                <apex:pageblocksectionitem >
                    <apex:outputlabel value="">Type
                    </apex:outputlabel>
                    <apex:outputtext value="Facility" />
                </apex:pageblocksectionItem>
            </apex:pageBlockSection>
            <apex:pageblockSection id="coverages" columns="1" title="Active Contracts"
                                   html-auto-doc="true">
                <apex:pageblocktable value="{!agreements}" var="objContrcat" rendered="{!NOT(ISNULL(agreements)) && agreements.size > 0}">
                    <apex:column headerValue="Plan Type">{!objContrcat.product}</apex:column>
                    <apex:column headerValue="Network ID">{!objContrcat.Network_ID}</apex:column>
                    <apex:column headerValue="Network Name"><apex:commandlink value="{!objContrcat.Network_Name}" onclick="return ContractNetwork_OnClick('{!objContrcat.Network_Name}', '{!objContrcat.effective}','{!objContrcat.cancel}', '{!ProviderId}', '{!taxId}', '{!providerTINTypeCodeParam}', '{!addressIdParam}', '{!addressTypeCodeParam}', '{!objContrcat.ContractDetailId}', '{!objContrcat.ContractHeaderId}', '{!objContrcat.Network_ID}', '{!objContrcat.BenefitPlanId}', '{!objContrcat.NetworkSchedule}');"/></apex:column>
                    <apex:column headerValue="Network Schedule ID">{!objContrcat.NetworkSchedule }</apex:column>
                    <apex:column headerValue="Benefit Plan ID">{!objContrcat.BenefitPlanId }</apex:column>
                    <apex:column headerValue="Fee Region">{!objContrcat.Pricing_Set_ID}</apex:column>
                    <apex:column headerValue="Effective">{!objContrcat.effective}</apex:column>
                    <apex:column headerValue="Cancel">{!objContrcat.cancel}</apex:column>
                    <apex:column headerValue="Accepting New Patients">{!objContrcat.Accepting_New_Patients}</apex:column>
                    <apex:column headerValue="Accepting Existing Patients">{!objContrcat.Accepting_Existing_Patients}</apex:column>
                    <apex:column headerValue="Provider Assignment Type">{!objContrcat.ProviderAssignmentType}</apex:column>
                </apex:pageBlockTable>
                <apex:pageBlockTable value="{!agreements}" var="r"
                                     rendered="{!(agreements.size == 0) && isErrorMessageAdded == false}" columnsWidth="1%">
                    <apex:column style="width:50%" headerValue=" No results found." styleClass="headerResultStyle"/>
                </apex:pageBlockTable>                  
            </apex:pageblockSection>
            
            <apex:pageBlockSection title="Additional Addresses" columns="1" html-auto-doc="true" id="pbsAdditionalAddresses" onclick="ToggleAdditionalAddress(this);">
                <script>twistSection(document.getElementById("{!$Component.pbsAdditionalAddresses}").childNodes[0].childNodes[0]);</script>
                <apex:outputPanel layout="none" id="pbtAdditionalAddresses">
                    <apex:pageblocktable value="{!AdditionalAddresses}" var="AddAddr" rendered="{!AdditionalAddresses != null && AdditionalAddresses.size > 0}">
                        <apex:column headerValue="Address Type" style="width=50%;">{!AddAddr.addressTypeCode}</apex:column>
                        <apex:column headerValue="Address" style="width=50%;">{!AddAddr.address}</apex:column>
                        <apex:column headerValue="County" style="width=50%;">{!AddAddr.County}</apex:column>
                        <apex:column headerValue="Phone" style="width=50%;">{!AddAddr.phoneNumber}</apex:column>
                        <apex:column headerValue="Fax" style="width=50%;">{!AddAddr.Fax}</apex:column>
                        <apex:column headerValue="Email" style="width=50%;">{!AddAddr.Email}</apex:column>
                    </apex:pageblocktable>
                    <apex:pageBlockTable value="{!AdditionalAddresses}" var="AddAddr" columnsWidth="2%" rendered="{!AdditionalAddresses == null || AdditionalAddresses.size == 0}">
                        <apex:column headerValue=" No results found." styleClass="headerResultStyle"/>
                    </apex:pageBlockTable> 
                </apex:outputPanel>
            </apex:pageBlockSection>  
                        
            <apex:pageBlockSection title="Practice Information" columns="1"
                                   html-auto-doc="true" id="pbsPracticeInfo">
                <apex:pageblocktable value="{!providerDetail.specialities}"
                                     var="objPratise">
                    <apex:column headerValue="Primary Specialty" style="width=50%;">{!objPratise.primarySpeciality}</apex:column>
                    <apex:column headerValue="Specialty" style="width=50%;">{!objPratise.speciality}</apex:column>
                    
                </apex:pageblocktable>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Affilated Providers" columns="1"
                                   html-auto-doc="true" id="pbsAffiliations" onclick="ToggleAffiliations(this);">
                <script>twistSection(document.getElementById("{!$Component.pbsAffiliations}").childNodes[0].childNodes[0]);</script>
                <apex:outputPanel layout="none" id="pbtAffiliations">
                    <apex:pageblocktable value="{!Affiliations}"  var="objAffPro">
                        <apex:column headerValue="Provider ID" style="width=30px;">{!objAffPro.ProviderId}</apex:column>
                        <apex:column headerValue="Name" style="width=30px;">{!objAffPro.Affiliation}</apex:column>
                        <apex:column headerValue="Primary Specialty" style="width=30px;">{!objAffPro.PrimarySpeciality}</apex:column>
                         <apex:column headerValue="Affiliation Effective Date" style="width=30px;">{!objAffPro.Effective}</apex:column>
                    </apex:pageblocktable>
                    <apex:pageBlockTable value="{!Affiliations}" var="Affiliations" columnsWidth="2%" rendered="{!Affiliations == null || Affiliations.size == 0}">
                        <apex:column headerValue=" No results found." styleClass="headerResultStyle"/>
                    </apex:pageBlockTable>                     
                </apex:outputPanel>
            </apex:pageBlockSection>
        </apex:pageBlock>
        <apex:actionStatus id="AjaxLoader" onstart="ShowLoader()" onstop="HideLoader()"/>
        <script>
            function ShowLoader() {
                $('.loader').fadeIn('fast');
            }
    
            function HideLoader() {
                $('.loader').fadeOut('fast');
            }
        </script>
        <span class="loader" style=" display: none;">
            <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.25; z-index: 1000; background-color: black;">
                &nbsp;
            </div>
            <div style="position: fixed; left: 0; top: 0; bottom: 0; right: 0; z-index: 1001; margin: 15% 50%">
                <div style="display: inline-block; padding: 2px; background-color: #fff; width: 125px;">
                    <img src="/img/loading.gif" style="float: left; margin: 8px;"/>
                    <span style="display: inline-block; padding: 10px 0px;">Loading...</span>
                </div>
            </div>
        </span>
    </apex:form>
    <apex:includeScript value="{!URLFOR($Resource.ACETResources, '/js/main.js')}" />
</apex:page>